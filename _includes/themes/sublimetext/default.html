<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <title>{{ page.title }}</title>
  {% if page.description %}<meta name="description" content="{{ page.description }}">{% endif %}

  <meta name="author" content="{{ site.author.name }}">
  <!-- Enable responsive viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <!-- Le styles -->
  <link href="{{ ASSET_PATH }}/theme.css" rel="stylesheet" media="all">
  <!-- Le fav and touch icons -->
  <link rel="shortcut icon" href="images/favicon.ico">
  <!-- atom & rss feed -->
  <link href="{{ BASE_PATH }}{{ site.JB.atom_path }}" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
  <link href="{{ BASE_PATH }}{{ site.JB.rss_path }}" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
</head>
<body>
  <div id="tabs" class="system">
    <h1 class="system">{{ page.title }}.html</h1>
  </div>
  <div id="main">
    <div id="content">
      {{ content }}
    </div>
    <div id="line-number">
    </div>
    <div id="minimap">
      <div id="minimap-content"></div>
      <div id="minimap-handler"></div>
      <div id="minimap-mask"></div>
    </div>
  </div>
  <div id="side-bar" class="system">
    <h3 class="side-bar-title system">RECENT ARTICLES</h3>
    <ul class="side-bar-group">
  {% for node in site.posts limit:5 %}  
    {% if page.url == node.url %}
      <li class="side-bar-1 side-bar-file active"><a href="{{ BASE_PATH }}{{node.url}}">{{node.title}}.html</a></li>
      {% else %}
      <li class="side-bar-1 side-bar-file"><a href="{{ BASE_PATH }}{{node.url}}">{{node.title}}.html</a></li>
    {% endif %}
  {% endfor %}
      <li class="side-bar-1 side-bar-file {% if page.url == HOME_PATH or page.url == '/index.html'%}active{% endif %}"><a href="{{ HOME_PATH }}">index.html</a></li>
    </ul>
    <h3 class="side-bar-title system">CATEGORIES</h3>
    <ul class="side-bar-group">
  {% assign posts_collate = site.posts %}
  {% for post in posts_collate  %}
    {% capture this_year %}{{ post.date | date: "%Y" }}{% endcapture %}
    {% capture this_month %}{{ post.date | date: "%B" }}{% endcapture %}
    {% capture next_year %}{{ post.previous.date | date: "%Y" }}{% endcapture %}
    {% capture next_month %}{{ post.previous.date | date: "%B" }}{% endcapture %}
  
    {% if forloop.first %}
      <li><span class="side-bar-1 side-bar-folder">{{this_year}} - {{this_month}}</span>
        <ul class="side-bar-group">
    {% endif %}
    {% if page.url == post.url %}
          <li class="side-bar-2 side-bar-file active"><a href="{{ BASE_PATH }}{{post.url}}">{{post.title}}.html</a></li>
    {% else %}
          <li class="side-bar-2 side-bar-file"><a href="{{ BASE_PATH }}{{post.url}}">{{post.title}}.html</a></li>
    {% endif %}
  
    {% if forloop.last %}
        </ul>
      </li>
    {% else %}
      {% if this_year != next_year %}
        </ul>
      </li>
      <li><span class="side-bar-1 side-bar-folder">{{next_year}} - {{next_month}}</span>
        <ul class="side-bar-group">
      {% else %}    
        {% if this_month != next_month %}
        </ul>
      </li>
      <li><span class="side-bar-1 side-bar-folder">{{next_year}} - {{next_month}}</span>
        <ul class="side-bar-group">
        {% endif %}
      {% endif %}
    {% endif %}
  {% endfor %}
    </ul>
  </div>
  <div id="status-bar" class="system">
    &copy; {{ site.time | date: '%Y' }} {{ site.author.name }} with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
  </div>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script>
  $(function(){
    //line-number
    var l = 0,i;
    var $lineNumber = $('#line-number');
    var $content = $('#content');
    $('#content > *').each(function(){
      var height = $(this).outerHeight(true);
      var n = Math.floor(height / 25);
      var m = height % 25;
      for(i=0;i<n;i++){
        l++;
        var p = $('<p></p>').text(l)
        if(i == n - 1 && m > 0)p.height(25+m);
        $lineNumber.append(p);
      }
    })
    //minimap
    var $contentCopy = $content.clone();
    var $minimap = $('#minimap')
    var $minimapContent = $('#minimap-content');
    var $minimapHandler = $('#minimap-handler');
    var $minimapMask = $('#minimap-mask');
    var $main = $('#main');
    var zoom = $minimapContent.width() / $content.width();
    var sh1 = $main.height()*zoom;
    var h = $content.outerHeight(true);
    $contentCopy.attr('id','content-copy').css({
      '-webkit-transform':'scale('+zoom+','+zoom+')'
    }).appendTo($minimapContent);
    $minimapHandler.height(sh1);
    $minimapMask.height(h*zoom);
    var moveMinimapHandler = function(y2){
      if(y2 < 0){
        $minimapHandler.css('top',0)
      }else if(y2 > h*zoom - sh1){
        $minimapHandler.css('top',(h*zoom - sh1)+'px')
      }else{
        $minimapHandler.css('top',y2+'px')
      }
    }
    var move = function(e){
      var y1 = e.offsetY;
      var y2 = y1 - sh1/2;
      var y = y2 / zoom;
      $main.scrollTop(y);
      moveMinimapHandler(y2);
    }
    $minimapMask.on('mousedown',function(e){
      $(this).on('mousemove',move);
      $minimap.addClass('scrolling');
    }).on('mouseup mouseleave',function(e){
      $(this).off('mousemove',move);
      $minimap.removeClass('scrolling');
    })
    var t;
    $main.on('scroll',function(e){
      var y = $main.scrollTop()
      var y2 = y * zoom;
      moveMinimapHandler(y2);

      if(!$minimap.hasClass('scrolling')){
        $minimap.addClass('scrolling');
      }else{
        clearTimeout(t);
      }
      t = setTimeout(function(){
        $minimap.removeClass('scrolling');
      },2000)
    })
    $( window ).resize(function() {
      console.log(sh1);
      sh1 = $main.height()*zoom;
      $minimapHandler.height(sh1);
    });
  })
  </script>
  {% include JB/analytics %}
</body>
</html>

